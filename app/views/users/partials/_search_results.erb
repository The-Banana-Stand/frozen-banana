<table class="table" style="border-collapse:collapse;">

  <thead>
  <tr><th>&nbsp;</th>
    <th><%= sort_link(@query, :company_name, 'Company', {}, {remote: true, method: :get} ) %></th>
    <th><%= sort_link(@query, :title, {}, {remote: true, method: :get} ) %></th>
    <th><%= sort_link(@query, :full_name, 'Name', {}, {remote: true, method: :get} ) %></th>
    <th><%= sort_link(@query, :city, 'City', {}, {remote: true, method: :get} ) %></th>
    <th><%= sort_link(@query, :state, 'State', {}, {remote: true, method: :get} ) %></th>
    <th><%= sort_link(@query, :zip_code, 'Zip Code', {}, {remote: true, method: :get} ) %></th>

  </tr>
  </thead>

  <tbody>

  <%- @decision_makers.each do |dm| %>

  <tr data-toggle="collapse" data-target="#dm<%= dm.id %>" class="accordion-toggle" role="button">
    <td><i class="glyphicon glyphicon-chevron-right"></i></td>
    <td><%= dm.company_name %></td>
    <td><%= dm.title %></td>
    <td><%= dm.full_name %></td>
    <td><%= dm.city %></td>
    <td><%= dm.state%></td>
    <td><%= dm.zip_code%></td>
  </tr>

  <tr>
    <td colspan="12" class="hiddenRow">
      <div class="accordian-body collapse" id="dm<%= dm.id %>">
        <div class="row well">
          <div class="col-md-4">
            <h4>
              <span class="evaluation-popover" data-toggle="popover" data-trigger="hover" data-placement="top"
                    data-content="It's okay if your product or service doesnâ€™t match what the decision maker is currently evaluating.">

                Evaluating <span class="glyphicon glyphicon-question-sign mag-icon"></span>:
              </span>
            </h4>
            <p>
              <%= dm.dm_evaluating || "#{dm.full_name} hasn't said what he's looking for in a meeting yet." %>
            </p>
          </div>
        </div>

        <div class="row match-my-cols">
          <div class="col-xs-4">

            <div class="panel panel-default text-center">
              <div class="panel-heading">
                <h3 class="panel-title x-large-text">
                  <strong>Meet Now</strong>
                  <a type="button" data-toggle="modal" data-target="#meetNowModal" class="pull-right btn-link btn-xs">
                    More Info
                  </a>
                </h3>
              </div>
              <div class="panel-body box">
                <div class="margin-top-lg">
                  <span class="large-text"> 30 Minutes</span> <br/>
                  <%= link_to "$#{dm.price}", new_meeting_path(dm.id), class: 'btn btn-success' %>
                </div>
              </div>
            </div>

          </div>

          <div class="col-xs-8">

            <div class="panel panel-default" id="meeting-queue-panel">
              <div class="panel-heading">
                <h3 class="panel-title text-center x-large-text">
                  <strong>Meeting Queue</strong>
                  <a type="button" data-toggle="modal" data-target="#meetingQueueModal" class="pull-right btn-link btn-xs">
                    More Info
                  </a>
                </h3>
              </div>

              <div class="panel-body panel-small box">
                <%= simple_form_for Bid.find_or_initialize_by(user_id: @user.id, meeting_queue_id: dm.meeting_queue.id), remote: true do |f| %>
                    <%= f.hidden_field :meeting_queue_id, value: dm.meeting_queue.id %>
                    <%= f.hidden_field :user_id, value: @user.id %>

                    <div class="row">

                      <div class="col-xs-5">
                        <div class="row">
                          <div class="col-xs-6 large-text">
                            <label for="meeting_length">Meeting Time:</label>
                            <div>
                              <%= select_tag :meeting_length, options_for_select(['30 Minutes', '30 Minutes']),
                                             class: 'form-control', disabled: true %>
                            </div>

                          </div>

                          <div class="col-xs-6">
                            <label for="bid_price" class="large-text">Amount:</label>
                            <div class="input-group input-group-sm">
                              <span class="input-group-addon">$</span>
                              <%- if f.object.can_rebid || !f.object.persisted? %>
                                  <%= f.input :price, as: :integer, label: false, class: 'form-control',
                                              required: true, input_html: {min: dm.meeting_queue.minimum_bid} %>
                              <%- else %>
                                  <%= f.input :price, as: :integer, label: false, class: 'form-control',
                                              required: true, disabled: true %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                        <!--row-->

                        <div class="row">
                          <div class="col-xs-6 col-xs-offset-6">
                            Min: $<%= dm.meeting_queue.minimum_bid %>
                          </div>
                        </div>
                        <!--row-->

                        <div class="row">
                          <div class="col-xs-12">
                            <div id="submit-container-<%= dm.meeting_queue.id %>" class="text-center submit-container">
                              <%- if f.object.persisted? && f.object.can_rebid %>
                                  <%= f.submit 'Update Bid', class: 'btn btn-success btn-lg' %>
                                  <%= link_to 'Cancel Bid', '#', class: 'btn-link btn-xs', remote: true, method: :delete %>
                              <%- elsif f.object.persisted? && !f.object.can_rebid %>
                                  <%= f.submit 'Already Bid', class: 'btn btn-success btn-lg margin-top', disabled: true %>
                                  <%= link_to 'Cancel Bid', '#', class: 'btn-link btn-xs', remote: true, method: :delete %>
                              <%- else %>
                                  <%= f.submit 'Request Place Holder', class: 'btn btn-success btn-lg' %>
                              <% end %>
                            </div>
                          </div>
                        </div>
                        <!--row-->
                      </div>
                      <!--col-xs-4 left-->

                      <div class="col-xs-4">
                        <div class="row">
                          <div class="col-xs-12">
                            <div class="panel panel-default">
                              <div class="panel-body">
                                <span class="evaluation-popover" data-toggle="popover" data-trigger="hover" data-placement="top"
                                      data-content="Whomever has the highest bid(s) at this time gets the available meeting(s) with <%= dm.full_name %>">
                                  <strong>Meeting Selection Time</strong> <span class="glyphicon glyphicon-question-sign mag-icon"></span>:
                                </span>
                                <br>
                                <%= dm.meeting_queue.show_block_close_date %>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-xs-12">
                            <div class="panel panel-default">
                              <div class="panel-body">
                                <span class="evaluation-popover" data-toggle="popover" data-trigger="hover" data-placement="top"
                                      data-content="<%= dm.full_name %> will allow MeetingSlice to put meetings
                                       on his calendar <%= dm.meeting_queue.meeting_frequency %>.">
                                  <strong>Time Available</strong> <span class="glyphicon glyphicon-question-sign mag-icon"></span>:
                                </span>
                                <br>
                                <%= dm.meeting_queue.meeting_frequency %>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!--col-xs-4 center-->

                      <div class="col-xs-3">
                        <div class="row">
                          <div class="col-xs-12">
                            <div class="panel panel-default">
                              <div class="panel-body">
                                <strong>Place in Line:</strong> <br>
                                1st (placeholder)
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-xs-12">
                            <div class="panel panel-default">
                              <div class="panel-body">
                                <strong>Estimated Wait:</strong> <br>
                                1 week
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!--col-xs-4 right-->

                    </div>
                    <!--row-->

                <% end %>
              </div>
              <!--panel-body-->
            </div>

          </div>
        </div>
      </div>
    </td>
  </tr>

  <% end %>

  </tbody>
</table>

<!-- Meeting Queue Modal -->
<div class="modal fade" id="meetingQueueModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Meeting Queue</h4>
      </div>
      <div class="modal-body">
        <p>Business Decision Makers have a limited amount of time allocated to hearing about innovative products and services.</p>

        <p>(Name) will allow MeetingSlice to put meetings on his calendar (hours per week).</p>

          <p>Here are the rules:<br/>
          1.    The higher your bid, the further up in the Queue you move.<br/>
          2.    You can only bid once every (weeks). No changes.<br/>
          3.    If you donâ€™t get selected, your bid rolls over to the next available meeting block.<br/>
          4.    You can change your bid once every (weeks).<br/>
          5.    After you bid, we will tell you where your rank and when you can expect to get a meeting.</p>

          <p>If you have already qualified this decision maker and have an innovative product, you should be willing to bid
          more for (name) time that someone that is using a â€˜spray and prayâ€™ approach.</p>

          <p>Why bid high for meetings?<br/>
          Rather than call (name) fourteen times and hope you get 2 minutes to pitch your idea, do everything you can
          to improve your probability of closing the account then decide how much the meeting is worth.  (Name) is
          willing to trade certainty that you will get a meeting with (him) for 30 minutes, if you will do the work upfront
          to qualify him and come totally prepared to solve his unique problem. The money is a signal!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Meet Now Modal -->
<div class="modal fade" id="meetNowModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Meet Now</h4>
      </div>
      <div class="modal-body">
        <p>Business Decision Makers have a limited amount of time allocated to hearing about innovative products and services.</p>

        <p>(Name) will allow MeetingSlice to put meetings on his calendar (hours per week).</p>

        <p>Here are the rules:<br/>
          1.    The higher your bid, the further up in the Queue you move.<br/>
          2.    You can only bid once every (weeks). No changes.<br/>
          3.    If you donâ€™t get selected, your bid rolls over to the next available meeting block.<br/>
          4.    You can change your bid once every (weeks).<br/>
          5.    After you bid, we will tell you where your rank and when you can expect to get a meeting.</p>

        <p>If you have already qualified this decision maker and have an innovative product, you should be willing to bid
          more for (name) time that someone that is using a â€˜spray and prayâ€™ approach.</p>

        <p>Why bid high for meetings?<br/>
          Rather than call (name) fourteen times and hope you get 2 minutes to pitch your idea, do everything you can
          to improve your probability of closing the account then decide how much the meeting is worth.  (Name) is
          willing to trade certainty that you will get a meeting with (him) for 30 minutes, if you will do the work upfront
          to qualify him and come totally prepared to solve his unique problem. The money is a signal!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<script>
  $('#attention-score-popover').popover({delay: { "show": 300, "hide": 100 }, container: 'body', html: true });
  $('.evaluation-popover').popover({delay: { "show": 300, "hide": 100 }, container: 'body', html: true });

  $('.simple_form').submit(function(event){
    $(this).find('#bid_price').prop('disabled', true)
  });
</script>